<html>
  <head>
    <!-- Font Awesome -->
    <link
      href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css"
      rel="stylesheet"
    />
    <link
      href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css"
      rel="stylesheet"
    />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
      rel="stylesheet"
    />
    <!-- MDB -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.10.2/mdb.min.css"
      rel="stylesheet"
    />
    <link href="./stylesheets/style.css" rel="stylesheet" />

    <!-- MDB -->
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.10.2/mdb.min.js"
    ></script>

    <script>
      function showImg(url) {
        const parent = document.querySelector("#screenshot");
        parent.classList.remove("d-none");

        const img = document.querySelector("#screenshot-img");
        img.setAttribute("src", url);

        const downloadUrl = document.querySelector("#screenshot-url");
        downloadUrl.setAttribute("download", url);
        downloadUrl.setAttribute("href", url);
      }

      function toggleLoader() {
        const el = document.querySelector(".spinner");
        if (el.classList.contains("d-none")) {
          el.classList.remove("d-none");
        } else {
          el.classList.add("d-none");
        }
      }
      function getScreenshot(ele) {
        if (event.key === "Enter") {
          let link = ele.value;

          var validURLRegularExpression = new RegExp(
            "^(https?:\\/\\/)?" + // protocol
              "((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|" + // domain name
              "((\\d{1,3}\\.){3}\\d{1,3}))" + // OR ip (v4) address
              "(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*" + // port and path
              "(\\?[;&a-z\\d%_.~+=-]*)?" + // query string
              "(\\#[-a-z\\d_]*)?$",
            "i"
          ); // fragment locator

          if (!validURLRegularExpression.test(link)) {
            alert("please enter a valid url");
            return;
          }

          toggleLoader();

          const url = window.location.href + "api/" + link;

          let xhr = new XMLHttpRequest();
          xhr.open("get", url);
          xhr.send();

          xhr.onload = function () {
            console.log(xhr.response);
            toggleLoader();
            showImg(xhr.response);
          };

          console.log(url);
        }
      }
    </script>
  </head>
  <div class="content">
      <h4 class="text-white header">
        Copy Wand <img class="wand-img" src="/wand.png"/> <small class="text-white">Get site screenshot</small>
      </h4>
        <input
          onkeydown="getScreenshot(this)"
          type="text"
          id="formWhite"
          class="form-control p-3 w-25"
          required
          placeholder="Input URL here! (must have http or https)"
          pattern="[(http(s)?):\/\/(www\.)?a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)"
        />
      <div class="spinner d-none m-5 d-flex justify-content-center">
        <div class="spinner-border" role="status">
          <span class="sr-only text-white">Loading...</span>
        </div>
      </div>

      <div
        id="screenshot"
        class="downloadFile d-none"
      >
       <a class="" id="screenshot-url" href="" download="">
          Download Screenshot
        </a>
        <img class="screenshot-img" id="screenshot-img" src="" />
      </div>
      <p class="pt-3 text-white">This search tool is here to let people test out the Copy Wand API before implementing it. <br/>
          If you have feature requests or found any bugs, please <a href = "mailto: programtanner@gmail.com">Send Me An Email</a>
      </p>
    </div>
  </div>
</html>


